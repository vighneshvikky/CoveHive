<%- include('../layouts/header.ejs') %>

<!-- Success and Error Messages -->
<div class="mb-4">
    <% if (success_msg) { %>
        <div class="bg-green-500 text-white p-4 rounded-md shadow-md relative">
            <%= success_msg %>
            <button class="absolute top-2 right-2 text-white " onclick="this.parentElement.style.display='none';"></button>
        </div>
    <% } else if (error_msg) { %>
        <div class="bg-red-500 text-white p-4 rounded-md shadow-md relative">
            <%= error_msg %>
            <button class="absolute top-2 right-2 text-white" onclick="this.parentElement.style.display='none';">✖</button>
        </div>
    <% } %>
</div>





<!-- Add Category Form -->
<form action="/admin/categories/add" method="POST" enctype="multipart/form-data" class="mb-6 p-4 border border-gray-300 rounded shadow">
    <div class="mb-4">
        <label for="name" class="block text-gray-700">Category Name:</label>
        <input type="text" id="name" name="name" required class="mt-1 p-2 border border-gray-300 rounded w-full" placeholder="Enter category name">
    </div>
    <div class="mb-4">
        <label for="image" class="block text-gray-700">Category Image:</label>
        <input type="file" id="image" name="image" accept="image/*" required class="mt-1">
    </div>
    <div>
        <button type="submit" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Add Category</button>
    </div>
</form>

<!-- Modal Structure -->
<div id="validationModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex justify-center items-center">
    <div class="bg-white p-6 rounded shadow-lg">
        <span class="close cursor-pointer text-red-500 float-right">&times;</span>
        <p id="modalMessage" class="text-gray-800"></p>
        <div class="mt-4">
            <button id="closeModalButton" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">Close</button>
        </div>
    </div>
</div>

<!-- Category Table -->
<table class="min-w-full border border-gray-300">
    <thead>
        <tr class="bg-gray-200">
            <th class="border border-gray-300 p-2">Image</th>
            <th class="border border-gray-300 p-2">Name</th>
            <th class="border border-gray-300 p-2">Actions</th>
        </tr>
    </thead>
    <tbody>
        <% categories.forEach(category => { %>
        <tr class="hover:bg-gray-100">
            <td class="border border-gray-300 p-2">
                <img src="/categoryImages/<%= category.img %>" alt="<%= category.name %>" class="w-16 h-16 object-cover">
            </td>
            <td class="border border-gray-300 p-2"><%= category.name %></td>
            <td class="border border-gray-300 p-2">
                <a href="/admin/categories/edit/<%= category._id %>" class="text-blue-500 hover:underline">Edit</a>
                <form action="/admin/categories/block-unblock/<%=category._id%>" method="post" class="inline">
                    <button type="submit" class="text-red-500 hover:underline ml-2">
                        <%= category.isBlocked ? 'Unblock' : 'Block' %>
                    </button>
                </form>
            </td>
        </tr>
        <% }); %>
    </tbody>
</table>

<!-- Pagination Controls -->
<div class="mt-4">
    <% for (let i = 1; i <= totalPages; i++) { %>
        <a href="/admin/categories?page=<%= i %>" class="inline-block mx-1 bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
            <%= i %>
        </a>
    <% } %>
</div>

<%- include('../layouts/footer.ejs') %>

<script>
    const form = document.querySelector('form');
    const modal = document.getElementById('validationModal');
    const modalMessage = document.getElementById('modalMessage');
    const closeModalButton = document.getElementById('closeModalButton');
    const closeModalSpan = document.querySelector('.close');

    form.addEventListener('submit', function (event) {
        const name = document.getElementById('name').value;
        const trimmedName = name.trim();
        const image = document.getElementById('image').files[0];

        if (!trimmedName) {
            showModal("Category name is required!");
            event.preventDefault();
        } else if (name !== trimmedName) {
            showModal("Category name should not contain leading or trailing spaces!");
            event.preventDefault();
        } else if (trimmedName.length < 3) {
            showModal("Category name must be at least 3 characters long!");
            event.preventDefault();
        }

        if (!image) {
            showModal("Please upload a category image!");
            event.preventDefault();
        } else if (!['image/jpeg', 'image/png', 'image/gif'].includes(image.type)) {
            showModal("Only JPG, PNG, and GIF formats are allowed!");
            event.preventDefault();
        }
    });

    function showModal(message) {
        modalMessage.textContent = message;
        modal.classList.remove("hidden");
    }

    const closeModal = () => {
        modal.classList.add("hidden");
    };

    closeModalButton.onclick = closeModal;
    closeModalSpan.onclick = closeModal;

    window.onclick = function(event) {
        if (event.target === modal) {
            closeModal();
        }
    }
</script>
<style>
    .notification {
    padding: 16px;
    border-radius: 8px;
    margin: 10px 0;
    position: relative;
    transition: all 0.3s ease;
}

.notification.success {
    background-color: #38a169; /* Green */
    color: white;
}

.notification.error {
    background-color: #e53e3e; /* Red */
    color: white;
}

.notification::after {
    content: '✖';
    position: absolute;
    top: 10px;
    right: 10px;
    cursor: pointer;
    font-size: 18px;
}

.notification:hover {
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
}
</style>
