<%- include('../layouts/header.ejs') %>

<form action="/admin/categories/add" method="POST" enctype="multipart/form-data">
    <div>
        <label for="name">Category Name:</label>
        <input type="text" id="name" name="name" required>
    </div>
    <div>
        <label for="image">Category Image:</label>
        <input type="file" id="image" name="image" accept="image/*" required>
    </div>
    <div>
        <button type="submit">Add Category</button>
    </div>
</form>
<!-- Modal Structure -->
<div id="validationModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white rounded-lg shadow-lg p-6 max-w-sm w-full">
        <span class="absolute top-2 right-2 text-gray-600 cursor-pointer close">&times;</span>
        <p id="modalMessage" class="text-gray-800"></p>
        <div class="mt-4">
            <button id="closeModalButton" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Close</button>
        </div>
    </div>
</div>
<table>
    <tr>
        <th>Image</th>
        <th>Name</th>
        <th>Actions</th>
    </tr>
    <% categories.forEach(category => { %>
    <tr>
        <td><img src="/categoryImages/<%= category.img %>" alt="<%= category.name %>" /></td>
        <td><%= category.name %></td>
        <td>
         
             <a href="/admin/categories/edit/<%= category._id %>">Edit</a>
            <form action="/admin/categories/delete/<%= category._id %>" method="POST">
                <button type="submit">Delete</button>
            </form>
        </td>
    </tr>
    <% }); %>
</table>

<!-- Pagination Controls -->
<div>
    <% for (let i = 1; i <= totalPages; i++) { %>
        <a href="/admin/categories?page=<%= i %>" class="<%= i === currentPage ? 'active' : '' %>">
            <%= i %>
        </a>
    <% } %>
</div>

<%- include('../layouts/footer.ejs') %>
<script>
    const form = document.querySelector('form');
    const modal = document.getElementById('validationModal');
    const modalMessage = document.getElementById('modalMessage');
    const closeModalButton = document.getElementById('closeModalButton');
    const closeModalSpan = document.querySelector('.close');

    form.addEventListener('submit', function (event) {
        const name = document.getElementById('name').value;
        const trimmedName = name.trim();
        const image = document.getElementById('image').files[0];

        if (!trimmedName) {
            showModal("Category name is required!");
            event.preventDefault();
        } else if (name !== trimmedName) {
            showModal("Category name should not contain leading or trailing spaces!");
            event.preventDefault();
        } else if (trimmedName.length < 3) {
            showModal("Category name must be at least 3 characters long!");
            event.preventDefault();
        }

        if (!image) {
            showModal("Please upload a category image!");
            event.preventDefault();
        } else if (!['image/jpeg', 'image/png', 'image/gif'].includes(image.type)) {
            showModal("Only JPG, PNG, and GIF formats are allowed!");
            event.preventDefault();
        }
    });

    function showModal(message) {
        modalMessage.textContent = message;
        modal.classList.remove("hidden");
    }

    const closeModal = () => {
        modal.classList.add("hidden");
    };

    closeModalButton.onclick = closeModal;
    closeModalSpan.onclick = closeModal;

    window.onclick = function(event) {
        if (event.target === modal) {
            closeModal();
        }
    }
</script>




